# 🛠 기술 문서 - BookManager

## 1. 구조 개요
- 전체 구조는 Controller-Service-Repository 3계층 구조로 설계
- MyBatis를 사용한 SQL 직접 매핑 → 실무 제어력 확보
- Thymeleaf를 통한 UI 연결

## 2. 도메인 설계 및 DB
- 도서(Book), 회원(Member), 관리자(Admin), 대출(Loan) 4가지 중심 테이블
- 모든 테이블은 기본키(id 또는 login_id) 기준으로 설계
- 회원 탈퇴는 `withdrawn` 필드를 이용한 논리 삭제 처리
- 각 도메인은 DB 컬럼과 정확히 매칭되도록 명명 일치

## 3. 예외 처리 및 검증
- 모든 컨트롤러에 대한 전역 예외 핸들링 구성
- 필드 단위 유효성 검증 (e.g. @NotBlank, @Email 등)
- 에러 발생 시 사용자 화면에 친절한 메시지 출력

## 4. 이미지 업로드
- MultipartFile로 이미지 수신
- MIME 타입 확인 및 확장자 체크
- UUID 기반 파일명 저장
- Thumbnailator 사용한 썸네일 생성
- /upload/, /upload/thumb/ 디렉토리에 분리 저장
- 도서 삭제 시 이미지 삭제 동기화 처리 포함

## 5. 로그인 기능
- 관리자 계정은 DB에 직접 저장
- 로그인 시 세션에 ID 저장 → 인증 유지
- 로그아웃은 POST 방식만 허용

## 6. 반납 기능 및 트러블슈팅 (일지 기반)
- ✅ MyBatis 매퍼 경로 누락 → `mapper-locations` 설정 수정
- ✅ 도서 삭제 시 이미지 삭제 누락 → FileStore 클래스에 deleteFile 추가
- ✅ 회원 삭제 후 대출 이력 오류 → 논리 삭제 구조로 리팩터링
- ✅ join 쿼리 오류 → loan에 LEFT JOIN 적용으로 해결

## 7. 테스트 방식
- 단위 테스트는 작성하지 않고 수동 확인 방식
- 각 기능은 웹 UI에서 입력 → 출력 확인 방식으로 검증

## 8. 향후 확장 가능 요소
- JWT 인증 + Spring Security 도입 가능
- 대출 기한, 연체 기능 추가 고려 가능
- 사용자용 프론트 화면 추가 시 권한 분리 구조로 확장 가능
